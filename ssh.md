Как добавить новый SSH-ключ на облачном сервере
Чтобы использовать пару ключей SSH для подключения к серверу, «публичная» часть пары должна быть размещена на сервере. Пожалуйста, обратитесь к первому разделу статьи «Как создать облачный сервер на Linux с доступом по SSH и подключиться к нему», чтобы узнать, как создавать пары ключей под Windows, Mac и Linux.

Теперь, когда у вас есть пара ключей, вам нужно добавить открытый ключ в файл «authorized_keys» в вашей домашней директории на сервере.

1. Подключитесь к серверу с помощью текущего ключа
    ssh cloud-user@1.2.3.4 -i /current_private_ssh_key

2. Добавить публичный ключ в файл authorized_keys
Вы можете добавить открытый ключ к файлу «authorized_keys» с помощью текстового редактора «nano» (или любого текстового редактора по вашему выбору):

    nano /home/cloud-user/.ssh/authorized_keys
    
Добавьте публичный ключ с новой строки и сохраните изменения, нажав Ctrl + X, Y, Enter.

Если у вас не установлен «nano»

Вы можете установить «nano», выполнив следующие команды в Ubuntu:

    sudo apt update && sudo apt upgrade
    sudo apt install nano
    
И в CentOS:
    yum update
    yum install nano -y
    
3. Проверьте новый ключ
Не завершая существующую сессию SSH, откройте новый сеанс с помощью только что добавленного ключа:

ssh cloud-user@1.2.3.4 -i /new_private_ssh_key
Если соединение установлено успешно, все в порядке. Чтобы удалить один из ключей, просто удалите его из «authorized_keys», используя тот же «nano».


**Добавление MAC OS**
Добавление ключа SSH в ssh-agent
Перед добавлением нового ключа SSH в ssh-agent для управления ключами необходимо проверить наличие существующих ключей SSH и создать новый ключ SSH. При добавлении ключа SSH в агент используйте команду macOS ssh-add по умолчанию, а не приложение, установленное macports, homebrew или другим внешним источником.

Запустите агент SSH в фоновом режиме.

    $ eval "$(ssh-agent -s)"
    > Agent pid 59566
В зависимости от среды может потребоваться использовать другую команду. Например, вам может потребоваться доступ с правами root, для чего необходимо выполнить sudo -s -H перед запуском агента SSH. Может также потребоваться использовать exec ssh-agent bash или exec ssh-agent zsh для запуска агента SSH.

Если вы используете macOS Sierra 10.12.2 или более поздней версии, необходимо внести изменения в файл ~/.ssh/config, чтобы автоматически загружать ключи в ssh-agent и хранить парольные фразы в цепочке ключей.

Сначала проверьте, существует ли файл ~/.ssh/config в расположении по умолчанию.

$ open ~/.ssh/config
> The file /Users/YOU/.ssh/config does not exist.
Если файл не существует, создайте файл.

$ touch ~/.ssh/config
Откройте файл ~/.ssh/config, а затем внесите в него изменения, чтобы он содержал следующие строки. Если файл ключа SSH имеет другое имя или путь, отличный от примера кода, измените имя файла или путь в соответствии с текущей настройкой.

Host github.com
  AddKeysToAgent yes
  UseKeychain yes
  IdentityFile ~/.ssh/id_ed25519
Примечания.

Если вы решили не добавлять парольную фразу к ключу, следует опустить строку UseKeychain.

Если появится сообщение об ошибке Bad configuration option: usekeychain, добавьте дополнительную строку в раздел конфигурации Host *.github.com.

Host github.com
  IgnoreUnknown UseKeychain
Добавьте закрытый ключ SSH в ssh-agent и сохраните парольную фразу в цепочке ключей. Если вы создали ключ с другим именем или добавляете существующий ключ с другим именем, замените id_ed25519 в команде на имя файла закрытого ключа.

$ ssh-add --apple-use-keychain ~/.ssh/id_ed25519
Примечание: Параметр --apple-use-keychain сохраняет парольную фразу в цепочке ключей при добавлении ключа SSH в ssh-agent. Если вы решили не добавлять парольную фразу в ключ, выполните команду без параметра --apple-use-keychain.

Параметр --apple-use-keychain находится в стандартной версии ssh-addApple . В версиях MacOS до Monterey (12.0) --apple-use-keychain флаги и --apple-load-keychain использовали синтаксис -K и -Aсоответственно.

Если у вас не установлена стандартная версия ssh-add Apple, может возникнуть ошибка. Дополнительные сведения см. в разделе Error: ssh-add: illegal option -- K.

